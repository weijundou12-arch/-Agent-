Step 1：私有化部署（模型层）——中国必须

业务要求：数据不出院、留痕审计、可控成本
落地方案（示例）

主模型：国产 LLM（私有 GPU 服务器）

备模型：云 LLM（仅用于“脱敏后的非敏感文本”或禁用）

VLM：本地多模态模型（用于扫描件/影像报告截图）

向量库：Milvus/FAISS（院内）

日志审计：每次回答记录 prompt_hash / user_id / doc_ids / sql_ids / tool_calls

指标（写进简历）

端到端延迟：P95 < 6s

可用性：99.9%

每 1k 请求成本：降低 30–50%（靠路由+缓存）

Step 2：RAG++（知识与数据的“进阶检索”，不是模板）
2.1 文档入库（指南/制度/说明书）

数据例子

文档 doc_id=G-ABX-2025-08

标题：抗菌药物指导原则

元数据：dept_scope=ICU/呼吸, version=2025.08, effective_date=2025-09-01

RAG++关键点

分块不是按字数：按“章节-推荐-证据等级”结构化切

建立倒排索引 + 向量索引双通道

权限过滤：例如 ICU 制度只有 ICU/药师可看

2.2 结构化优先检索（比向量更可靠）

例：用户问

“ICU 患者发热 39℃，CRP 156，PIPTA 用了 48h 无好转，下一步建议？”

RAG++先跑结构化检索：

从 orders 查抗生素已用时长

从 lab_results 查趋势

从 vitals_ts 查热峰持续

然后再去文档库检索“升级/降阶梯、培养、覆盖范围、证据等级”。

输出必须带引用：例如引用到 doc_id + section。

你要交付的 KPI

引用正确率（citation correctness）：≥ 95%

幻觉率（无依据医疗建议）：≤ 1%

检索召回（关键章节 Recall@10）：≥ 0.85

Step 3：Tool Calling（工具调用）——把“会说”变成“会干活”
3.1 SQL 工具（真实 SQL id 留痕）

工具：query_sql(sql_template, params)

示例调用（系统内部）：

sql_id=SQL_021

模板：查抗菌药物使用与检验趋势

参数：adm_id=A2026-001928

返回（截断示例）：

抗生素：PIPTA 已用 52 小时

CRP：120 → 156（上升）

PCT：0.9 → 2.1（上升）

血培养：已采集，未回报

3.2 内部 API 工具（对接 HIS/EMR）

工具：create_order_suggestion(payload)
只生成“建议单”，不直接下医嘱（合规/安全）。

payload 示例：

suggested_action=“加做痰培养 + 调整覆盖 MRSA 风险评估”

risk_reason=“PCT 升高+氧合下降+48h 无改善”

3.3 Python 分析工具（科研/统计）

工具：run_analysis(script_id, params)

科研场景：抽取队列后自动跑描述性统计

script_id=STAT_DESC_V1

输出：Table 1（年龄、性别、合并症、指标均值等）

Level 1：受控自动（90% 企业真实形态）
用户 → Agent → LLM 生成 tool_call → 系统校验 → 执行工具


这是你项目里应该做、企业真正要的。

自动的部分

LLM 自动“选择”工具

自动生成参数

自动多轮调用

不自动的部分（必须人工/系统拦）

权限校验

参数合法性校验

风险动作确认

写操作的双重确认

📌 这才是“会干活但不乱干”的 AI

Step 4：LLM-based Agent（多步规划 + 执行 + 回写）
真实“Agent 工作流”（以场景 A 为例）

用户一句话：

“帮我评估这个 ICU 病人的感染风险，给出下一步策略，生成病程记录草稿。”

Agent 的多步执行（每步都有数据）

获取患者摘要（tool→SQL_001）

得到：诊断、用药、培养、关键体征

风险评分/规则判断（tool→python sepsis_rule_v2）

读入 vitals_ts + lab_results

输出：SOFA 变化、感染可能性等级

检索指南建议（RAG++）

召回：抗菌药升级/降阶梯章节 + ICU 制度

生成建议（LLM）

输出 3 档建议：必须做/建议做/可选

每条绑定引用 + 数据依据（如 CRP/PCT 趋势）

生成病程记录草稿（合规模板）

自动填入：客观数据 + 评估 + 计划（SOAP）

写回系统（tool→API draft_note）

只写草稿，要求医生确认签名

你要定义的 Agent 评估指标

任务完成率（E2E）：≥ 80%

工具调用正确率：≥ 95%

失败重试后成功率：≥ 90%

医生采纳率（建议被使用）：≥ 30%（现实很高了）

Step 5：多模型编排（中国企业常态：国产+备份+专用）
路由策略（具体、可写代码）

结构化提取/SQL解释：轻量模型（便宜、快）

医疗建议生成：高质量本地模型（更稳）

多模态 OCR/表格识别：VLM 专用

超长指南问答：长上下文模型 + 检索

数据驱动路由例子

输入 tokens > 12k → 走长上下文

需要引用 ≥3 → 强制走 RAG++ pipeline

PII 检测触发 → 禁止外部云模型

Step 6：长期记忆（让系统“越用越懂你”，但合规）
记忆存什么（中国合规友好）

用户偏好：喜欢表格还是要点

常用科室模板：ICU/呼吸/骨科

任务状态：科研项目 ID、变量字典版本

禁止存：身份证/手机号/完整病历正文（只存 hash 或摘要）

样例

user_id=U1023

pref_output=“先结论后证据表”

dept=ICU

last_project=“HAI_Sepsis_2026Q1”

Step 7：VLM（Vision+Language）——用“具体影像/扫描件数据”落地
中国真实用法：扫描件/外院报告/图片表格

输入：一张扫描的检验单图片
VLM 输出：

结构化表格（项目/值/单位/参考范围）

识别异常项（↑↓）

生成“可用于 SQL 入库”的 JSON

然后 Agent 再调用工具把结果写回 lab_results_external 表。

评估指标

字段提取准确率：≥ 98%（关键字段）

单位一致性：≥ 99%

错误报警：识别不确定时必须提示人工复核

Step 8：Time-series + LLM（时序解释与异常归因）
场景 C：运营/设备/病情都能用

例：系统检测到 ICU 平均住院日本周上升 18%
Agent 会：

拉取时序 KPI（kpi_ts）

分解归因：床位周转、术后并发症、感染事件、检验周转

结合制度与历史对照（RAG++）

输出建议：改流程/补资源/追踪指标

输出示例（可写进简历）

“主要贡献来自：血培养回报时间 P95 从 22h→34h；导致抗菌方案延迟调整；与 ICU 感染上升相关（引用制度条款 + 数据图表）”

你要的“每一步都有数据”：我再给你一个完整端到端示例（浓缩版）

输入（医生一句话）
“ICU A2026-001928 发热持续、PCT 上升，PIPTA 48h 无效，给下一步建议并生成病程草稿。”

系统实际做的事（带数据）

SQL 拉取：PIPTA 52h；PCT 0.9→2.1；SpO2 92→88

RAG++ 命中：指南章节“48–72h 无效的处理”、院内 ICU 制度“会诊/培养要求”

工具调用：创建“培养建议单”草稿

输出：

必须做：复核培养、评估耐药风险（引用 doc_id + section）

建议做：根据风险覆盖调整（明确写出“依据：PCT 上升+氧合下降”）

病程模板：自动填入 CRP/PCT/vitals
